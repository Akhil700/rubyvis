<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8' content='text/html' http-equiv='Content-Type'>
<link href='../style.css' rel='stylesheet' type='text/css'>
<title>Rubyvis - Example: Antibiotic Effectiveness : Pie chart</title>
</head>
<body>
<h1>Rubyvis - Example: Antibiotic Effectiveness : Pie chart</h1>
<div class='example_main'>
<div class='description'><p>After World War II, antibiotics earned the moniker “wonder drugs” for quickly treating previously-incurable diseases. Data was gathered to determine which drug worked best for each bacterial infection. Comparing drug performance was an enormous aid for practitioners and scientists alike. In the fall of 1951, Will Burtin published this graph showing the effectiveness of three popular antibiotics on 16 different bacteria, measured in terms of minimum inhibitory concentration.<br />
Recreating this display revealed some minor errors in the original: a missing grid line at 0.01 μg/ml, and an exaggeration of some values for penicillin.</p></div>
<div class='navigation'>
<ul>
<li>
<a href='../index.html'>Home</a>
</li>
<li>
<a href='4_pv_custom_antibiotics_antibiotics_scatter.html'>Previous: Antibiotic Effectiveness : Scatterplot</a>
</li>
<li>
<a href='4_pv_custom_barley_barley.html'>Next: Becker’s Barley</a>
</li>
</ul>
</div>
<div class='image'>
<!--[if IE]>
<embed class='svg' height='800' src='4_pv_custom_antibiotics_antibiotics_wedge.svg' width='700'>
<![endif]-->
<object class='svg' data='4_pv_custom_antibiotics_antibiotics_wedge.svg' height='800' type='image/svg+xml' width='700'></object>
</div>
<div class='source'><div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rubyvis</span><span style="color:#710">'</span></span>&#x000A;load(<span style="color:#036;font-weight:bold">File</span>.dirname(<span style="color:#069">__FILE__</span>)+<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/antibiotics_data.rb</span><span style="color:#710">&quot;</span></span>)&#x000A;&#x000A;width = <span style="color:#00D">700</span>&#x000A;height = <span style="color:#00D">700</span>&#x000A;inner_radius = <span style="color:#00D">90</span>&#x000A;outer_radius = <span style="color:#00D">300</span> - <span style="color:#00D">10</span>&#x000A;&#x000A;drug_color = {&#x000A;  <span style="color:#A60">:penicillin</span>=&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rgb(10, 50, 100)</span><span style="color:#710">&quot;</span></span>,&#x000A;  <span style="color:#A60">:streptomycin</span>=&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rgb(200, 70, 50)</span><span style="color:#710">&quot;</span></span>,&#x000A;  <span style="color:#A60">:neomycin</span>=&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">black</span><span style="color:#710">&quot;</span></span>&#x000A;}&#x000A;gram_color = {&#x000A;  <span style="color:#A60">:positive</span>=&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rgba(174, 174, 184, .8)</span><span style="color:#710">&quot;</span></span>,&#x000A;  <span style="color:#A60">:negative</span>=&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rgba(230, 130, 110, .8)</span><span style="color:#710">&quot;</span></span>&#x000A;}&#x000A;&#x000A;<span style="color:#777"># Burtin's radius encoding is, as far as I can tell, sqrt(log(mic)).</span>&#x000A;min = <span style="color:#036;font-weight:bold">Math</span>.sqrt(<span style="color:#036;font-weight:bold">Math</span>.log(<span style="color:#60E">0.001</span> * <span style="color:#60E">1e4</span>))&#x000A;max = <span style="color:#036;font-weight:bold">Math</span>.sqrt(<span style="color:#036;font-weight:bold">Math</span>.log(<span style="color:#00D">1000</span> * <span style="color:#60E">1e4</span>))&#x000A;a = (outer_radius - inner_radius) / (min - max.to_f)&#x000A;b = inner_radius - a * max&#x000A;&#x000A;radius = lambda {|mic| a * <span style="color:#036;font-weight:bold">Math</span>.sqrt(<span style="color:#036;font-weight:bold">Math</span>.log(mic * <span style="color:#60E">1e4</span>)) + b}&#x000A;&#x000A;<span style="color:#777"># The pie is split into equal sections for each bacteria, with a blank</span>&#x000A;<span style="color:#777"># section at the top for the grid labels. Each wedge is further</span>&#x000A;<span style="color:#777"># subdivided to make room for the three antibiotics, equispaced.</span>&#x000A;&#x000A;big_angle = <span style="color:#60E">2.0</span> * <span style="color:#036;font-weight:bold">Math</span>::<span style="color:#036;font-weight:bold">PI</span> / (<span style="color:#d70">$bacteria</span>.length + <span style="color:#60E">1.0</span>)&#x000A;small_angle = big_angle / <span style="color:#60E">7.0</span>&#x000A;<span style="color:#777">#/* The root panel. */</span>&#x000A;vis = <span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Panel</span>.new.&#x000A;  width(width).&#x000A;  height(height).&#x000A;  bottom(<span style="color:#00D">100</span>);&#x000A;&#x000A;&#x000A;&#x000A;<span style="color:#777"># Background wedges to indicate gram staining color.</span>&#x000A;bg = vis.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Wedge</span>).&#x000A;  data(<span style="color:#d70">$bacteria</span>). <span style="color:#777"># assumes Burtin's order</span>&#x000A;  left(lambda {|i| width / <span style="color:#60E">2.0</span>}).&#x000A;  top(height / <span style="color:#60E">2.0</span>).&#x000A;  inner_radius(inner_radius).&#x000A;  outer_radius(outer_radius).&#x000A;  angle(big_angle).&#x000A;  start_angle(lambda {|d| &#x000A;  index * big_angle + big_angle / <span style="color:#60E">2.0</span> - <span style="color:#036;font-weight:bold">Math</span>::<span style="color:#036;font-weight:bold">PI</span> / <span style="color:#60E">2.0</span>&#x000A;  }).&#x000A;  fill_style(lambda {|d|&#x000A;  <span style="color:#036;font-weight:bold">Rubyvis</span>.color(gram_color[d[<span style="color:#A60">:gram</span>].to_sym])&#x000A;  })&#x000A;&#x000A;<span style="color:#777"># Antibiotics. </span>&#x000A;&#x000A;bg.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Wedge</span>).&#x000A;  angle(small_angle).&#x000A;  start_angle(lambda {|d| &#x000A;    bg.start_angle() + small_angle&#x000A;  }).&#x000A;  outer_radius(lambda {|d| &#x000A;  radius.call(d[<span style="color:#A60">:penicillin</span>])&#x000A;  }).&#x000A;  fill_style(drug_color[<span style="color:#A60">:penicillin</span>]).&#x000A;    add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Wedge</span>).&#x000A;    start_angle(lambda {|d| &#x000A;    proto.start_angle() + <span style="color:#00D">2</span> * small_angle}).&#x000A;    outer_radius(lambda {|d| &#x000A;      radius.call(d[<span style="color:#A60">:streptomycin</span>])&#x000A;    }).&#x000A;    fill_style(drug_color[<span style="color:#A60">:streptomycin</span>]).&#x000A;    add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Wedge</span>).&#x000A;    outer_radius(lambda {|d|&#x000A;      radius.call(d[<span style="color:#A60">:neomycin</span>])&#x000A;    }).&#x000A;    fill_style(drug_color[<span style="color:#A60">:neomycin</span>])&#x000A;&#x000A;<span style="color:#777"># Circular grid lines. </span>&#x000A;&#x000A;bg.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Dot</span>)&#x000A;    .data(<span style="color:#036;font-weight:bold">Rubyvis</span>.range(<span style="color:#00D">-3</span>, <span style="color:#00D">4</span>))&#x000A;    .fill_style(<span style="color:#069">nil</span>)&#x000A;    .stroke_style(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#eee</span><span style="color:#710">&quot;</span></span>)&#x000A;    .line_width(<span style="color:#00D">1</span>)&#x000A;    .shape_size(lambda {|i| &#x000A;      radius.call(<span style="color:#00D">10</span>**i)** <span style="color:#00D">2</span>&#x000A;    }).&#x000A;  anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">top</span><span style="color:#710">&quot;</span></span>).add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Label</span>).&#x000A;    visible(lambda {|i| i &lt; <span style="color:#00D">3</span>}).&#x000A;    text_baseline(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">middle</span><span style="color:#710">&quot;</span></span>).&#x000A;    text(lambda {|i| &#x000A;      i&lt;<span style="color:#00D">0</span> ? (<span style="color:#00D">10</span>** i).to_f : (<span style="color:#00D">10</span>**i).to_i&#x000A;    })&#x000A;&#x000A;<span style="color:#777"># Radial grid lines. </span>&#x000A;&#x000A;bg.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Wedge</span>)&#x000A;.data(<span style="color:#036;font-weight:bold">Rubyvis</span>.range(<span style="color:#d70">$bacteria</span>.size + <span style="color:#00D">1</span>))&#x000A;    .inner_radius(inner_radius - <span style="color:#00D">10</span>)&#x000A;    .outer_radius(outer_radius + <span style="color:#00D">10</span>)&#x000A;    .fill_style(<span style="color:#069">nil</span>)&#x000A;    .stroke_style(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">black</span><span style="color:#710">&quot;</span></span>)&#x000A;    .angle(<span style="color:#00D">0</span>)&#x000A;&#x000A;<span style="color:#777"># Labels. </span>&#x000A;bg.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">outer</span><span style="color:#710">&quot;</span></span>).add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Label</span>)&#x000A;    .text_align(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">center</span><span style="color:#710">&quot;</span></span>)&#x000A;    .text(lambda {|d| d[<span style="color:#A60">:name</span>]})&#x000A;&#x000A;<span style="color:#777"># Antibiotic legend. </span>&#x000A;vis.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Bar</span>)&#x000A;    .data(<span style="color:#036;font-weight:bold">Rubyvis</span>.keys(drug_color))&#x000A;    .right(width / <span style="color:#00D">2</span> + <span style="color:#00D">3</span>)&#x000A;    .top(lambda { height / <span style="color:#60E">2.0</span> - <span style="color:#00D">28</span> + <span style="color:#069">self</span>.index * <span style="color:#00D">18</span>})&#x000A;    .fill_style(lambda {|d| drug_color[d]})&#x000A;    .width(<span style="color:#00D">36</span>)&#x000A;    .height(<span style="color:#00D">12</span>)&#x000A;  .anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">right</span><span style="color:#710">&quot;</span></span>).add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Label</span>)&#x000A;    .textMargin(<span style="color:#00D">6</span>)&#x000A;    .textAlign(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">left</span><span style="color:#710">&quot;</span></span>);&#x000A;&#x000A;<span style="color:#777"># Gram-stain legend.</span>&#x000A;vis.add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Dot</span>).&#x000A;  data([<span style="color:#A60">:positive</span>, <span style="color:#A60">:negative</span>]).&#x000A;  left(width / <span style="color:#60E">2.0</span> - <span style="color:#00D">20</span>).&#x000A;  bottom(lambda { <span style="color:#00D">-60</span> + index * <span style="color:#00D">18</span>}).&#x000A;  fill_style(lambda {|d| gram_color[d]}).&#x000A;  stroke_style(<span style="color:#069">nil</span>).&#x000A;  shape_size(<span style="color:#00D">30</span>).&#x000A;  anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">right</span><span style="color:#710">&quot;</span></span>).add(<span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Label</span>).&#x000A;    text_margin(<span style="color:#00D">6</span>).&#x000A;    text_align(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">left</span><span style="color:#710">&quot;</span></span>).&#x000A;    text(lambda {|d| <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Gram-</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>d<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>})&#x000A;&#x000A;vis.render&#x000A;puts vis.to_svg</pre></div>
</div>
</div>
</div>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5764936-8']);
  _gaq.push(['_trackPageview']);
  
  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
