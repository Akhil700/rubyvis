<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8' content='text/html' http-equiv='Content-Type'>
<link href='../style.css' rel='stylesheet' type='text/css'>
<title>Rubyvis - Example: Antibiotic Effectiveness : Scatterplot</title>
</head>
<body>
<h1>Rubyvis - Example: Antibiotic Effectiveness : Scatterplot</h1>
<div class='example_main'>
<div class='description'><p>After World War II, antibiotics earned the moniker “wonder drugs” for quickly treating previously-incurable diseases. Data was gathered to determine which drug worked best for each bacterial infection. Comparing drug performance was an enormous aid for practitioners and scientists alike. In the fall of 1951, Will Burtin published this graph showing the effectiveness of three popular antibiotics on 16 different bacteria, measured in terms of minimum inhibitory concentration.<br />
Recreating this display revealed some minor errors in the original: a missing grid line at 0.01 μg/ml, and an exaggeration of some values for penicillin.</p></div>
<div class='navigation'>
<ul>
<li>
<a href='../index.html'>Home</a>
</li>
<li>
<a href='3_pv_conventional_stacked_charts.html'>Previous: Stacked Area</a>
</li>
<li>
<a href='4_pv_custom_antibiotics_antibiotics_wedge.html'>Next: Antibiotic Effectiveness : Pie chart</a>
</li>
</ul>
</div>
<div class='image'>
<!--[if IE]>
<embed class='svg' height='639' src='4_pv_custom_antibiotics_antibiotics_scatter.svg' width='609'>
<![endif]-->
<object class='svg' data='4_pv_custom_antibiotics_antibiotics_scatter.svg' height='639' type='image/svg+xml' width='609'></object>
</div>
<div class='source'><div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rubyvis</span><span style="color:#710">'</span></span>&#x000A;load(<span style="color:#036;font-weight:bold">File</span>.dirname(<span style="color:#069">__FILE__</span>)+<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/antibiotics_data.rb</span><span style="color:#710">&quot;</span></span>)&#x000A;&#x000A;s = <span style="color:#00D">180</span>&#x000A;_p = <span style="color:#00D">20</span>&#x000A;z = pv.Scale.log(<span style="color:#60E">0.001</span>, <span style="color:#00D">1000</span>).range(<span style="color:#00D">0</span>, s)&#x000A;color = pv.colors(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">darkred</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">darkblue</span><span style="color:#710">&quot;</span></span>)&#x000A;ticks = pv.range(<span style="color:#00D">-2</span>, <span style="color:#00D">3</span>).map {|e| (<span style="color:#00D">10</span>**e).to_f}&#x000A;&#x000A;<span style="color:#777">#/* Root panel. */</span>&#x000A;vis = <span style="color:#036;font-weight:bold">Rubyvis</span>::<span style="color:#036;font-weight:bold">Panel</span>.new&#x000A;    .height(s * <span style="color:#d70">$antibiotics</span>.size+ _p * (<span style="color:#d70">$antibiotics</span>.size- <span style="color:#00D">1</span>))&#x000A;    .width(lambda {<span style="color:#069">self</span>.height()})&#x000A;    .top(<span style="color:#60E">14.5</span>)&#x000A;    .left(<span style="color:#60E">14.5</span>)&#x000A;    .bottom(<span style="color:#00D">44</span>)&#x000A;    .right(<span style="color:#00D">14</span>);&#x000A;&#x000A;<span style="color:#777">#/* Cell for each antibiotic pair. */</span>&#x000A;cell = vis.add(pv.Panel)&#x000A;    .data(<span style="color:#d70">$antibiotics</span>)&#x000A;    .width(s)&#x000A;    .left(lambda {(s + _p) * <span style="color:#069">self</span>.index})&#x000A;  .add(pv.Panel)&#x000A;    .data(<span style="color:#d70">$antibiotics</span>)&#x000A;    .height(s)&#x000A;    .top(lambda{(s + _p) * <span style="color:#069">self</span>.index})&#x000A;&#x000A;<span style="color:#777">#/* Label. */</span>&#x000A;cell.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">center</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;.visible(lambda {|d,y, x| <span style="color:#080;font-weight:bold">return</span>  x == y})&#x000A;    .font(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bold 14px sans-serif</span><span style="color:#710">&quot;</span></span>)&#x000A;    .text(lambda {|d, y, x| x});&#x000A;&#x000A;<span style="color:#777">#/* Dot plot and frame. */</span>&#x000A;plot = cell.add(pv.Panel)&#x000A;    .data(lambda {|y, x| [x]})&#x000A;    .visible(lambda {|x, y| x != y})&#x000A;    .stroke_style(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#aaa</span><span style="color:#710">&quot;</span></span>);&#x000A;&#x000A;<span style="color:#777">#/* Ticks. */</span>&#x000A;tick = pv.Rule.new()&#x000A;    .visible(lambda {|d, x, y| x != y})&#x000A;    .data(ticks)&#x000A;    .stroke_style(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#ddd</span><span style="color:#710">&quot;</span></span>);&#x000A;&#x000A;<span style="color:#777">#/* X-axis ticks. */</span>&#x000A;xtick = plot.add(pv.Rule)&#x000A;    .mark_extend(tick)&#x000A;    .left(z);&#x000A;&#x000A;<span style="color:#777">#/* Bottom and top labels. */</span>&#x000A;xtick.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bottom</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;    .visible(lambda {cell.index == <span style="color:#d70">$antibiotics</span>.size- <span style="color:#00D">1</span>});&#x000A;xtick.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">top</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;    .visible(lambda {cell.index == <span style="color:#00D">0</span>});&#x000A;&#x000A;<span style="color:#777">#/* Y-axis ticks. */</span>&#x000A;ytick = plot.add(pv.Rule)&#x000A;    .mark_extend(tick)&#x000A;    .bottom(z);&#x000A;&#x000A;<span style="color:#777">#/* Bottom and top labels. */</span>&#x000A;ytick.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">right</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;    .visible(lambda {cell.parent.index == <span style="color:#d70">$antibiotics</span>.size- <span style="color:#00D">1</span>})&#x000A;    .text_angle(<span style="color:#036;font-weight:bold">Math</span>::<span style="color:#036;font-weight:bold">PI</span> / <span style="color:#60E">2.0</span>)&#x000A;    .text_baseline(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bottom</span><span style="color:#710">&quot;</span></span>)&#x000A;    .text_align(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">center</span><span style="color:#710">&quot;</span></span>);&#x000A;ytick.anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">left</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;    .visible(lambda {cell.parent.index == <span style="color:#00D">0</span>})&#x000A;    .text_angle(-<span style="color:#036;font-weight:bold">Math</span>::<span style="color:#036;font-weight:bold">PI</span> / <span style="color:#60E">2.0</span>)&#x000A;    .text_baseline(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bottom</span><span style="color:#710">&quot;</span></span>)&#x000A;    .text_align(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">center</span><span style="color:#710">&quot;</span></span>);&#x000A;&#x000A;<span style="color:#777">#/* Dot plot. */</span>&#x000A;dot = plot.add(pv.Dot).&#x000A;  data(<span style="color:#d70">$bacteria</span>).&#x000A;  stroke_style(lambda { |d|&#x000A;    color.scale(d[<span style="color:#A60">:gram</span>])&#x000A;  }).&#x000A;  fill_style(lambda {|d|&#x000A;    color.scale(d[<span style="color:#A60">:gram</span>]).alpha(<span style="color:#60E">0.2</span>)&#x000A;  }).&#x000A;  left(lambda {|d, x, y|&#x000A;    z.scale(d[x.to_sym])&#x000A;  }).&#x000A;  bottom(lambda {|d, x, y|&#x000A;    z.scale(d[y.to_sym])&#x000A;  }).&#x000A;  title(lambda {|d| d[<span style="color:#A60">:name</span>]})&#x000A;&#x000A;<span style="color:#777">#/* Legend. */</span>&#x000A;vis.add(pv.Dot)&#x000A;    .mark_extend(dot)&#x000A;    .data([{<span style="color:#606">gram</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">positive</span><span style="color:#710">&quot;</span></span>}, {<span style="color:#606">gram</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">negative</span><span style="color:#710">&quot;</span></span>}])&#x000A;    .bottom(<span style="color:#00D">-30</span>)&#x000A;    .left(lambda { index * <span style="color:#00D">100</span>})&#x000A;    .title(<span style="color:#069">nil</span>)&#x000A;  .anchor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">right</span><span style="color:#710">&quot;</span></span>).add(pv.Label)&#x000A;    .text(lambda {|d| <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Gram-</span><span style="color:#710">&quot;</span></span> + d[<span style="color:#A60">:gram</span>]});&#x000A;&#x000A;vis.render();&#x000A;puts vis.to_svg</pre></div>
</div>
</div>
</div>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5764936-8']);
  _gaq.push(['_trackPageview']);
  
  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
